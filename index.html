<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Υβριδική Επιλογή Εικόνας</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 5px; }
    img.preview { height: 80px; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Επιλογή Εικόνας Παραγγελίας</h2>

  <!-- Dropdown από προϋπάρχουσες εικόνες -->
  <label>Επιλογή από αποθηκευμένες:</label>
  <select id="savedSelect">
    <option value="">-- Επιλογή είδους --</option>
  </select>

  <br>

  <!-- Ή μεταφόρτωση νέας εικόνας -->
  <label>Ή ανέβασε νέα εικόνα:</label>
  <input type="file" id="imageInput" accept="image/*">

  <br>

  <input type="text" id="barcode" placeholder="Barcode">
  <input type="text" id="description" placeholder="Περιγραφή">

  <img id="preview" class="preview" alt="Προεπισκόπηση">

  <script>
    const savedSelect = document.getElementById('savedSelect');
    const imageInput = document.getElementById('imageInput');
    const barcodeInput = document.getElementById('barcode');
    const descriptionInput = document.getElementById('description');
    const preview = document.getElementById('preview');

    const baseURL = "orders/images/";

    // Παράδειγμα αποθηκευμένων ειδών
    const savedItems = [
      { barcode: "8888888824244", description: "MEGA TAURUS 800gr" },
      { barcode: "8888888811114", description: "PROFESSIONAL 300 ΧΡΗΣΕΙΣ" }
    ];

    function populateDropdown() {
      savedItems.forEach((item, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${item.barcode} - ${item.description.replace(/_/g, ' ')}`;
        savedSelect.appendChild(option);
      });
    }

    // Επιλογή από dropdown
    savedSelect.addEventListener('change', function () {
      const item = savedItems[this.value];
      if (item) {
        barcodeInput.value = item.barcode;
        descriptionInput.value = item.description.replace(/_/g, ' ');
        preview.src = baseURL + `${item.barcode}_${item.description}.jpg`;
      }
    });

    // Επιλογή αρχείου
    imageInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => preview.src = e.target.result;
        reader.readAsDataURL(file);

        const name = file.name.replace(/\.[^/.]+$/, "");
        const parts = name.split("_");
        if (parts.length >= 2) {
          barcodeInput.value = parts[0];
          descriptionInput.value = parts.slice(1).join(" ");
        } else {
          barcodeInput.value = name;
          descriptionInput.value = "";
        }

        savedSelect.value = ""; // Καθαρίζει το dropdown
      }
    });

    populateDropdown();
  </script>
</body>
</html>
